<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCA Simulator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>DCA Simulator</h1>
            <p>Visualize your Dollar Cost Averaging strategy</p>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="calculator">
                <span class="tab-icon">üßÆ</span>
                <span class="tab-label">Calculator</span>
            </button>
            <button class="tab-button" data-tab="about">
                <span class="tab-icon">üìñ</span>
                <span class="tab-label">About</span>
            </button>
        </div>

        <!-- About Tab Content -->
        <div class="tab-content" id="about-tab" style="display: none;">
            <div class="hero-section">
            <div class="hero-intro">
                <h2>Plan Your Investment Journey with Real Historical Data</h2>
                <p class="hero-tagline">
                    Simulate decades of investment strategies in seconds. See how your portfolio would have performed
                    with different amounts, frequencies, and market conditions using actual stock prices and dividends.
                </p>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Investment Strategies</h3>
                    <p>Test daily, weekly, or monthly contributions. Add lump sum investments. Set account balance limits.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Advanced Analytics</h3>
                    <p>Track Sharpe ratio, CAGR, max drawdown, volatility, win rate, and more. Compare against benchmarks like S&P 500.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3>Dividend Reinvestment</h3>
                    <p>See the power of compounding! Toggle dividend reinvestment on/off to compare growth strategies.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Margin Trading</h3>
                    <p>Simulate leveraged investing (1x to 2x). Track margin calls, interest costs, and forced liquidations.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üèñÔ∏è</div>
                    <h3>Retirement Planning</h3>
                    <p>Model portfolio withdrawals! Set threshold and monthly withdrawal amount to plan your retirement income.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Real Market Data</h3>
                    <p>Powered by Yahoo Finance. Test strategies on any stock, ETF, or crypto going back decades.</p>
                </div>
            </div>

            <div class="cta-section">
                <h3>What Can You Simulate?</h3>
                <ul class="simulation-examples">
                    <li><strong>The Classic:</strong> "$500/month into S&P 500 for 30 years"</li>
                    <li><strong>The Catch-Up:</strong> "$100k lump sum + $2,000/month with 1.5x leverage"</li>
                    <li><strong>The Retiree:</strong> "Withdraw $5,000/month once portfolio hits $1M"</li>
                    <li><strong>The Comparison:</strong> "Tesla vs Bitcoin vs S&P 500 since 2015"</li>
                    <li><strong>The What-If:</strong> "What if I invested during the 2008 crash?"</li>
                </ul>
                <p class="cta-arrow"><strong>Switch to Calculator tab to start simulating</strong></p>
            </div>
            </div>
        </div>

        <!-- Calculator Tab Content -->
        <div class="tab-content" id="calculator-tab">
            <div class="main-content">
            <div class="controls">
                <div class="control-grid">
                    <div class="input-group relative">
                        <label for="ticker">Stock Ticker</label>
                        <input type="text" id="ticker" placeholder="e.g. AAPL or BTC-USD" value="AAPL"
                            autocomplete="off">
                        <div id="ticker-suggestions" class="suggestions-dropdown"></div>
                    </div>
                    <div class="input-group">
                        <label for="start-date">Start Date</label>
                        <input type="date" id="start-date" value="2023-01-01">
                    </div>
                    <div class="input-group">
                        <label for="end-date" class="label-with-tooltip">
                            <span>End Date (Optional)</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">End date for the simulation. If left blank, simulates from start date to today. Use this to test "what if" scenarios during specific historical periods (e.g., through the 2008 crisis, COVID crash, etc.).</span>
                            </div>
                        </label>
                        <input type="date" id="end-date">
                    </div>
                    <div class="input-group">
                        <label for="initial-amount">Initial Investment ($)</label>
                        <input type="text" id="initial-amount" placeholder="e.g. 1,000" value="100,000"
                            inputmode="numeric">
                    </div>
                    <div class="input-group">
                        <label for="account-balance" class="label-with-tooltip">
                            <span>Account Balance ($)</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Maximum cash available for investing. Once this amount is fully invested, no more purchases are made (unless using margin). Leave blank for unlimited cash. Useful for simulating "invest until cash depletes" scenarios.</span>
                            </div>
                        </label>
                        <input type="text" id="account-balance" placeholder="Optional (e.g. 5,000)" value="150,000"
                            inputmode="numeric">
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label for="amount">Recurring Amount ($)</label>
                            <input type="text" id="amount" placeholder="e.g. 100" value="500" inputmode="numeric">
                        </div>
                        <div class="input-group">
                            <label for="frequency">Investment Frequency</label>
                            <select id="frequency">
                                <option value="DAILY" selected>Daily</option>
                                <option value="WEEKLY">Weekly (Same Weekday)</option>
                                <option value="MONTHLY">Monthly (First Trading Day)</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group relative">
                        <label for="benchmark">Benchmark Ticker (Optional)</label>
                        <input type="text" id="benchmark" placeholder="e.g. SPY" value="SPY" autocomplete="off">
                        <div id="benchmark-suggestions" class="suggestions-dropdown"></div>
                    </div>
                    <div class="input-group">
                        <label for="margin-ratio" class="label-with-tooltip">
                            <span>Margin Ratio</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Maximum leverage allowed. 1x = no margin (cash only). 2x = borrow up to 100% of your equity. Interest charged monthly at Fed Funds Rate + 0.5%. Margin is only used when cash depletes.</span>
                            </div>
                        </label>
                        <select id="margin-ratio">
                            <option value="1.0" selected>1x (No Margin)</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="1.75">1.75x</option>
                            <option value="2.0">2x</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="maintenance-margin" class="label-with-tooltip">
                            <span>Maintenance Margin (%)</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Minimum equity ratio required to avoid margin calls. If your equity falls below this percentage, the broker will liquidate shares to restore the ratio. Common value: 25%</span>
                            </div>
                        </label>
                        <input type="number" id="maintenance-margin" placeholder="e.g. 25" value="25" min="0" max="100"
                            step="1">
                    </div>
                    <div class="input-group">
                        <label for="withdrawal-threshold" class="label-with-tooltip">
                            <span>Withdrawal Threshold ($)</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Portfolio value that triggers withdrawal mode. Once your portfolio reaches this amount, you'll begin monthly withdrawals. This simulates the decumulation phase of retirement planning.</span>
                            </div>
                        </label>
                        <input type="text" id="withdrawal-threshold" placeholder="Optional (e.g. 500,000)"
                            inputmode="numeric">
                    </div>
                    <div class="input-group">
                        <label for="monthly-withdrawal" class="label-with-tooltip">
                            <span>Monthly Withdrawal ($)</span>
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Amount to withdraw monthly once the portfolio reaches the withdrawal threshold. Withdrawals happen on the first trading day of each month. Used for retirement income planning.</span>
                            </div>
                        </label>
                        <input type="text" id="monthly-withdrawal" placeholder="Optional (e.g. 5,000)"
                            inputmode="numeric">
                    </div>
                </div>

                <div class="actions">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="reinvest">
                        <label for="reinvest">Reinvest Dividends</label>
                    </div>
                    <button id="calculate-btn">Calculate</button>
                </div>
            </div>

            <div class="warning-container" id="warning-container" style="display: none;"></div>

            <div class="results" id="results-area" style="display: none;">
                <!-- Hero Metrics Section -->
                <div class="section-header">
                    <h2>Key Performance</h2>
                </div>
                <div class="hero-cards">
                    <div class="card hero-card">
                        <h3>Total Return</h3>
                        <p id="total-return" class="hero-value">-</p>
                        <span id="total-return-delta" class="delta">-</span>
                    </div>
                    <div class="card hero-card">
                        <h3>Net Portfolio Value</h3>
                        <p id="net-portfolio-value" class="hero-value">-</p>
                        <span class="subtitle">After Debt</span>
                    </div>
                    <div class="card hero-card">
                        <h3>ROI</h3>
                        <p id="roi" class="hero-value">-</p>
                        <span class="subtitle">vs Invested</span>
                    </div>
                </div>

                <!-- Investment Overview Section -->
                <div class="section-header">
                    <h2>Investment Overview</h2>
                </div>
                <div class="summary-cards">
                    <div class="card">
                        <h3>Total Invested</h3>
                        <p id="total-invested">-</p>
                    </div>
                    <div class="card">
                        <h3>Current Value</h3>
                        <p id="current-value">-</p>
                    </div>
                    <div class="card">
                        <h3>Total Shares</h3>
                        <p id="total-shares">-</p>
                    </div>
                    <div class="card">
                        <h3>Average Cost</h3>
                        <p id="average-cost">-</p>
                    </div>
                    <div class="card">
                        <h3>Total Dividends</h3>
                        <p id="total-dividends">-</p>
                    </div>
                    <div class="card">
                        <h3>Account Balance</h3>
                        <p id="account-balance-summary">-</p>
                    </div>
                </div>

                <!-- Risk & Performance Analytics Section -->
                <div class="section-header">
                    <h2>Risk & Performance Analytics</h2>
                </div>
                <div class="analytics-section">
                    <div class="analytics-subsection">
                        <h3 class="subsection-title">Risk Metrics</h3>
                        <div class="analytics-cards">
                            <div class="card analytics-card">
                                <h4>Sharpe Ratio</h4>
                                <p id="sharpe-ratio" class="analytics-value">-</p>
                                <span id="sharpe-label" class="metric-label">-</span>
                            </div>
                            <div class="card analytics-card">
                                <h4>Max Drawdown</h4>
                                <p id="max-drawdown" class="analytics-value">-</p>
                                <span id="drawdown-dates" class="metric-label">-</span>
                            </div>
                            <div class="card analytics-card">
                                <h4>Volatility</h4>
                                <p id="volatility" class="analytics-value">-</p>
                                <span class="metric-label">Annualized</span>
                            </div>
                            <div class="card analytics-card">
                                <h4>Win Rate</h4>
                                <p id="win-rate" class="analytics-value">-</p>
                                <div id="win-rate-bar" class="progress-bar">
                                    <div id="win-rate-fill" class="progress-fill"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-subsection">
                        <h3 class="subsection-title">Performance Metrics</h3>
                        <div class="analytics-cards">
                            <div class="card analytics-card">
                                <h4>CAGR</h4>
                                <p id="cagr" class="analytics-value">-</p>
                                <span class="metric-label">Annualized</span>
                            </div>
                            <div class="card analytics-card">
                                <h4>Best Day</h4>
                                <p id="best-day" class="analytics-value">-</p>
                                <span id="best-day-date" class="metric-label">-</span>
                            </div>
                            <div class="card analytics-card">
                                <h4>Worst Day</h4>
                                <p id="worst-day" class="analytics-value">-</p>
                                <span id="worst-day-date" class="metric-label">-</span>
                            </div>
                            <div class="card analytics-card">
                                <h4>Calmar Ratio</h4>
                                <p id="calmar-ratio" class="analytics-value">-</p>
                                <span id="calmar-label" class="metric-label">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Benchmark Comparison Section (conditional) -->
                <div id="benchmark-section" style="display: none;">
                    <div class="section-header">
                        <h2>Benchmark Comparison</h2>
                    </div>
                    <div class="summary-cards">
                        <div class="card">
                            <h3>Benchmark Value</h3>
                            <p id="benchmark-value">-</p>
                        </div>
                        <div class="card">
                            <h3>Alpha</h3>
                            <p id="alpha">-</p>
                            <span id="alpha-label" class="subtitle">-</span>
                        </div>
                        <div class="card">
                            <h3>Beta</h3>
                            <p id="beta">-</p>
                            <span id="beta-label" class="subtitle">-</span>
                        </div>
                    </div>
                </div>

                <!-- Margin Trading Section (conditional) -->
                <div id="margin-section" style="display: none;">
                    <div class="section-header">
                        <h2>Margin Trading</h2>
                    </div>
                    <div class="summary-cards margin-section-cards">
                        <div class="card margin-card">
                            <h3>Total Borrowed</h3>
                            <p id="total-borrowed">-</p>
                        </div>
                        <div class="card margin-card">
                            <h3>Interest Paid</h3>
                            <p id="interest-paid">-</p>
                        </div>
                        <div class="card margin-card">
                            <h3>Current Leverage</h3>
                            <p id="current-leverage">-</p>
                        </div>
                        <div class="card margin-card">
                            <h3>Margin Calls</h3>
                            <p id="margin-calls">-</p>
                        </div>
                        <div class="card no-margin-card" style="display: none;">
                            <h3>No Margin Value</h3>
                            <p id="no-margin-value">-</p>
                        </div>
                        <div class="card no-margin-card" style="display: none;">
                            <h3>No Margin ROI</h3>
                            <p id="no-margin-roi">-</p>
                        </div>
                    </div>
                </div>

                <!-- Withdrawal Section (conditional) -->
                <div id="withdrawal-section" style="display: none;">
                    <div class="section-header">
                        <h2>Withdrawal Mode</h2>
                    </div>
                    <div class="summary-cards withdrawal-section-cards">
                        <div class="card withdrawal-card">
                            <h3>Total Withdrawn</h3>
                            <p id="total-withdrawn">-</p>
                        </div>
                        <div class="card withdrawal-card">
                            <h3>Start Date</h3>
                            <p id="withdrawal-start-date">-</p>
                        </div>
                        <div class="card withdrawal-card">
                            <h3>Withdrawal Count</h3>
                            <p id="withdrawal-count">-</p>
                        </div>
                        <div class="card withdrawal-card">
                            <h3>Status</h3>
                            <p id="withdrawal-status">-</p>
                        </div>
                    </div>
                </div>

                <!-- Chart Section -->
                <div class="chart-container">
                    <canvas id="dcaChart"></canvas>
                </div>

                <!-- Margin Call Details Table -->
                <div id="margin-call-table-container" style="display: none; margin-top: 30px;">
                    <h3 style="color: #f59e0b; margin-bottom: 15px;">‚ö†Ô∏è Margin Call History</h3>
                    <div style="overflow-x: auto;">
                        <table id="margin-call-table" class="margin-call-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Price</th>
                                    <th>Equity Ratio Before</th>
                                    <th>Equity Ratio After</th>
                                    <th>Shares Sold</th>
                                    <th>Sale Proceeds</th>
                                    <th>Debt Paid</th>
                                    <th>Portfolio Before</th>
                                    <th>Portfolio After</th>
                                    <th>Equity Before</th>
                                    <th>Equity After</th>
                                </tr>
                            </thead>
                            <tbody id="margin-call-table-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Withdrawal History Table -->
                <div id="withdrawal-table-container" style="display: none; margin-top: 30px;">
                    <h3 style="color: #10b981; margin-bottom: 15px;">üí∞ Withdrawal History</h3>
                    <div style="overflow-x: auto;">
                        <table id="withdrawal-table" class="withdrawal-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Price</th>
                                    <th>Shares Sold</th>
                                    <th>Sale Proceeds</th>
                                    <th>Debt Repaid</th>
                                    <th>Withdrawn</th>
                                    <th>Cumulative</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawal-table-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>